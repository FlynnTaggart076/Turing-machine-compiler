# Инварианты памяти машины Тьюринга

## Раскладка памяти на ленте

```
Позиция:  -10   -9   -8   -7   -6   -5   -4   -3   -2   -1    0    1    2   ...
Символ:   BOM   b7   b6   b5   b4   b3   b2   b1   b0   EOM   []   []   []  ...
          ^^^   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^  ^^^   ^^^^^^^^^^^^^^^
          |     |                                         |     |
          |     |                                         |     +-- Пользовательская зона
          |     |                                         +-- Маркер конца памяти (End Of Memory)
          |     +-- 8 бит переменной x (two's complement)
          +-- Маркер начала памяти (Begin Of Memory)
```

## Инвариант памяти

На ленте **всегда** существуют маркеры:
- `tape[-10] = "BOM"` (Begin Of Memory)
- `tape[-1] = "EOM"` (End Of Memory)

Ячейки `[-9..-2]` содержат только `"0"` или `"1"` — это двухкомплементарное представление 8-битной знаковой переменной `x` (int8).

### Формат переменной x

- **Позиция -9**: MSB (старший бит, знаковый бит) — bit index 0
- **Позиция -2**: LSB (младший бит) — bit index 7

Значение `x` вычисляется как two's complement:
- Если MSB = 0: `x = b7*64 + b6*32 + b5*16 + b4*8 + b3*4 + b2*2 + b1*1 + b0*1`
- Если MSB = 1: `x = -128 + b7*64 + ...` (отрицательное число)

Диапазон значений: **[-128..127]**

## Инвариант движения

Лента ограничена слева маркером `"BOM"`:
- При попытке `move_left` когда головка находится на `"BOM"`, головка **остаётся на месте** (`Move::Stay`).

Это гарантирует, что пользовательский код не может случайно выйти за пределы ленты влево.

## ABI для var-операций

После **любой** операции с переменной `x` (`x = N`, `x++`, `x--`, проверка `x < N`) головка возвращается в **позицию 0** — первую ячейку пользовательской зоны (сразу справа от EOM).

### Алгоритм var-операций

1. Переход к системной зоне (goToBOM или goToEOM)
2. Выполнение операции над битами
3. Возврат в пользовательскую зону (goToEOM + move_right)

## Поддерживаемые операции

### Присваивание константы
```
x = 123;    // где 123 в диапазоне [-128..127]
x = -1;
x = 0;
```

### Инкремент/декремент
```
x++;        // x = x + 1 с переполнением (127++ → -128)
x--;        // x = x - 1 с переполнением (-128-- → 127)
```

### Условия для if/while
```
if (x < 10) { ... }
while (x < 10) { x++; }
```

## Ограничения

1. Поддерживается **только одна переменная** — `x`.
2. Переменная имеет тип **int8** (8 бит, знаковое).
3. В условиях поддерживается **только** оператор `<` с константой.
4. Нельзя напрямую писать в системную зону `[-10..-1]` пользовательским кодом.
5. Нельзя перезаписывать маркеры `BOM` и `EOM`.

## Примеры программ

### Пример 1: Простое присваивание
```
Set_alphabet "a b";
Setup "a";

proc main() {
    x = 42;
}
```

### Пример 2: Цикл с переменной
```
Set_alphabet "a b";
Setup "";

proc main() {
    x = 1;
    while (x < 10) {
        x++;
    }
    // После цикла x == 10
}
```

### Пример 3: Переполнение
```
Set_alphabet "a";
Setup "";

proc main() {
    x = 127;
    x++;        // x станет -128
}
```
